<!DOCTYPE html> {{ partial "structure/head" . }} {{ partial "menu.html" . }}
<main>

    <div id="content" class="site-content">
        <div id="primary" class="content-area">
            <main id="main" class="site-main" role="main">

                <div class="container">
                    <div class="pure-g">
                        <!-- article -->
                        <div class="pure-u-md-16-24 pure-u-1">
                            <div class="">
                                <header class="page-header">
                                    <h1 class="page-title">
                                        
                                        <span>Pesquisa</span></h1>

                                        <div class="search-form">
                                            <div class="form-group">
                                                <label for="search" class="sr-only">Pesquisar</label>
                                                <input type="text" id="search" class="form-control search-field"
                                                    placeholder="Pesquisar">
                                            </div>
                                            <!-- .form-group -->
                                        </div>

                                   <!-- <div class="taxonomy-description">
                          <p>Just eat healthy food from now</p>
                        </div> -->
                                </header>
                                <div class="pure-g container-masonry category" id="results">

                                </div>
                                <!-- .row -->

                                <!-- <nav class="navigation pagination" role="navigation">
                                    <h2 class="screen-reader-text">Posts navigation</h2>
                                    <div class="nav-links">
                                        <a class="prev page-numbers" href="#">Prev</a>
                                        <a class="page-numbers" href="#">1</a>
                                        <span class="page-numbers current">2</span>
                                        <span class="page-numbers dots">…</span>
                                        <a class="page-numbers" href="#">4</a>
                                        <a class="next page-numbers" href="#">Next</a>
                                    </div>
                                </nav> -->
                                <!-- .nav-links -->
                                <!-- .navigation -->
                            </div>
                        </div>
                        <!-- .col-md-9 -->

                        <!-- sidebar -->
                        <div class="pure-u-md-8-24 pure-u-1">
                            {{ partial "sidebar.html" . }}
                        </div>
                    </div>
                    <!-- .row -->
                </div>
                <!-- .container -->

            </main>
            <!-- #main -->
        </div>
        <!-- #primary -->
    </div>
    <!-- #content -->
</main>

{{ partial "structure/foot" . }}
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://unpkg.com/lunr/lunr.js"></script>
    
    
    <script type="text/javascript">
        var lunrIndex,
            $results,
            pagesIndex;


        function initLunr() {

            $.getJSON("../js/lunr/PagesIndex.json")
                .done(function (index) {
                    pagesIndex = index;
                    console.log("index:", pagesIndex);



                    lunrIndex = lunr(function () {
                        var that = this;
                        this.field("title", {
                            boost: 10
                        });
                        this.field("tags", {
                            boost: 5
                        });
                        this.field("content");


                        this.ref("href");

                        pagesIndex.forEach(function (page) {
                            that.add(page);
                        });
                    });

                })
                .fail(function (jqxhr, textStatus, error) {
                    var err = textStatus + ", " + error;
                    console.error("Error getting Hugo index flie:", err);
                }).done(function () {
                    initUI();
                });
        }





        function search(query) {





            return lunrIndex.search(query.normalize('NFD').replace(/[\u0300-\u036f]/g, "") + "*").map(function (result) {
                return pagesIndex.filter(function (page) {
                    return page.href === result.ref;
                })[0];
            });
        }



        function renderResults(results) {
            if (!results.length) {
                return;
            }


            results.slice(0, 10).forEach(function (result) {
                // var $result = $("<li>");
                // $result.append($("<a>", {
                //     href: result.href,
                //     text: "» " + result.title
                // }));
                $results.append($('<div class="pure-u-md-12-24 pure-u-1"> <article class= "post post-grid format-standard hentry" >' +
                    '<div class="entry-featured-image"><amp-img src="'+ result.thumb +'" layout="responsive" width="337.5" height="337.5" alt=""></amp-img></div> ' +

                    '<div class="entry-area">' +
                        '<div class="entry-header">' +
                            '<h2 class="entry-title">' +
                                '<a href="'+ result.href +'" rel="bookmark">' + result.title + '</a>' +
                            '</h2>' +
                        '</div>' +
                        '<div class="entry-content">' +
                            '<p class="text-center">' +
                                result.description +
                                '<a href="' + result.href +'" class="more-link">' +
                                    '<span class="moretext">Leia Mais</span>' +
                                    '<span class="screen-reader-text">Título</span>' +
                                '</a>' +
                            '</p>' +
                        '</div>' +
                    '</div>' +
                    '</article> </div >'));
                // $results.append($result);
            });
        }



        initLunr();

        function initUI() {
            $results = $("#results");
            $search = $("#search");
            var query;
            var uri_dec = decodeURIComponent(window.location.href);
            urlQuery = new RegExp('[\?&]query=([^]*)').exec(uri_dec);
            console.log(urlQuery);
            if (urlQuery !== null) {
                query = urlQuery[1];
                $search.val(urlQuery[1]);
                var results = search(query);
                renderResults(results);
            }
            $("#search").keyup(function () {
                $results.empty();


                var query = $(this).val();
                if (query.length < 2) {
                    return;
                }

                var results = search(query);

                renderResults(results);
            });
        }

        $(document).ready(function () {


        });
    </script>
    <script id="article-template" type="text/x-custom-template">
       <div class="pure-u-md-12-24 pure-u-1">
            <article class="post post-grid format-standard hentry">
                <div class="entry-featured-image">
                    <amp-img src="" layout="responsive" width="337.5" height="337.5" alt=""></amp-img>
                </div>

                <div class="entry-area">
                    <div class="entry-header">
                        <h2 class="entry-title">
                            <a href="" rel="bookmark">Título</a>
                        </h2>
                        <div class="entry-meta">
                            <span class="posted-on">
                                <a href="" rel="bookmark">
                                    <time class="entry-date" datetime="2016-10-26"></time>
                                </a>
                            </span>

                        </div>
                                                </div>
                                                <div class="entry-content">
                        <p class="text-center">
                            
                            <a href="" class="more-link">
                                <span class="moretext">Leia Mais</span>
                                <span class="screen-reader-text">Título</span>
                            </a>
                                                    </p>
                    </div>
                                            </div>
                                        </article>
                                    </div>
    </script>